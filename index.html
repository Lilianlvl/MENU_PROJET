<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planificateur de Menus Hebdomadaires</title>
  <style>
    /* Tailwind CSS minimal pour l'application */
    body {
      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      background-color: #f3f4f6;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      max-width: 1024px;
      margin-left: auto;
      margin-right: auto;
      padding: 1rem;
    }
    .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
    .font-bold { font-weight: 700; }
    .text-center { text-align: center; }
    .mb-6 { margin-bottom: 1.5rem; }
    .w-full { width: 100%; }
    .p-2 { padding: 0.5rem; }
    .border { border-width: 1px; border-color: #d1d5db; }
    .rounded { border-radius: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .bg-blue-500 { background-color: #3b82f6; }
    .text-white { color: #ffffff; }
    .hover\:bg-blue-600:hover { background-color: #2563eb; }
    .bg-red-500 { background-color: #ef4444; }
    .hover\:bg-red-600:hover { background-color: #dc2626; }
    .grid { display: grid; }
    .gap-4 { gap: 1rem; }
    .bg-white { background-color: #ffffff; }
    .p-4 { padding: 1rem; }
    .rounded { border-radius: 0.25rem; }
    .shadow { box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .font-semibold { font-weight: 600; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .font-medium { font-weight: 500; }
    .list-disc { list-style-type: disc; }
    .pl-5 { padding-left: 1.25rem; }
    .flex { display: flex; }
    .justify-between { justify-content: space-between; }
    .items-center { align-items: center; }
    .text-red-500 { color: #ef4444; }
    .hover\:text-red-700:hover { color: #b91c1c; }
    .mt-4 { margin-bottom: 1rem; }
  </style>
</head>
<body>
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">Planificateur de Menus Hebdomadaires</h1>
    
    <div class="mb-6">
      <input id="mealInput" type="text" placeholder="Entrez un plat..." class="w-full p-2 border rounded">
      <select id="daySelect" class="w-full p-2 mt-2 border rounded">
        <option value="Lundi">Lundi</option>
        <option value="Mardi">Mardi</option>
        <option value="Mercredi">Mercredi</option>
        <option value="Jeudi">Jeudi</option>
        <option value="Vendredi">Vendredi</option>
      </select>
      <select id="timeSelect" class="w-full p-2 mt-2 border rounded">
        <option value="midi">Midi</option>
        <option value="soir">Soir</option>
      </select>
      <select id="personSelect" class="w-full p-2 mt-2 border rounded">
        <option value="Lilian">Lilian</option>
        <option value="Océane">Océane</option>
        <option value="Les deux">Les deux</option>
      </select>
      <button id="addMealBtn" class="w-full bg-blue-500 text-white p-2 mt-2 rounded hover:bg-blue-600">Ajouter le plat</button>
    </div>

    <div id="weeklyMenu" class="grid gap-4">
      <div id="Lundi" class="bg-white p-4 rounded shadow">
        <h2 class="text-xl font-semibold">Lundi</h2>
        <h3 class="text-lg font-medium mt-2">Midi</h3>
        <ul class="list-disc pl-5" data-time="midi"></ul>
        <h3 class="text-lg font-medium mt-2">Soir</h3>
        <ul class="list-disc pl-5" data-time="soir"></ul>
      </div>
      <div id="Mardi" class="bg-white p-4 rounded shadow">
        <h2 class="text-xl font-semibold">Mardi</h2>
        <h3 class="text-lg font-medium mt-2">Midi</h3>
        <ul class="list-disc pl-5" data-time="midi"></ul>
        <h3 class="text-lg font-medium mt-2">Soir</h3>
        <ul class="list-disc pl-5" data-time="soir"></ul>
      </div>
      <div id="Mercredi" class="bg-white p-4 rounded shadow">
        <h2 class="text-xl font-semibold">Mercredi</h2>
        <h3 class="text-lg font-medium mt-2">Midi</h3>
        <ul class="list-disc pl-5" data-time="midi"></ul>
        <h3 class="text-lg font-medium mt-2">Soir</h3>
        <ul class="list-disc pl-5" data-time="soir"></ul>
      </div>
      <div id="Jeudi" class="bg-white p-4 rounded shadow">
        <h2 class="text-xl font-semibold">Jeudi</h2>
        <h3 class="text-lg font-medium mt-2">Midi</h3>
        <ul class="list-disc pl-5" data-time="midi"></ul>
        <h3 class="text-lg font-medium mt-2">Soir</h3>
        <ul class="list-disc pl-5" data-time="soir"></ul>
      </div>
      <div id="Vendredi" class="bg-white p-4 rounded shadow">
        <h2 class="text-xl font-semibold">Vendredi</h2>
        <h3 class="text-lg font-medium mt-2">Midi</h3>
        <ul class="list-disc pl-5" data-time="midi"></ul>
        <h3 class="text-lg font-medium mt-2">Soir</h3>
        <ul class="list-disc pl-5" data-time="soir"></ul>
      </div>
    </div>

    <button id="clearMenuBtn" class="w-full bg-red-500 text-white p-2 mt-4 rounded hover:bg-red-600">Effacer le menu</button>
  </div>

  <script>
    // Structure par défaut du menu
    const defaultMenu = {
      Lundi: { midi: [], soir: [] },
      Mardi: { midi: [], soir: [] },
      Mercredi: { midi: [], soir: [] },
      Jeudi: { midi: [], soir: [] },
      Vendredi: { midi: [], soir: [] }
    };

    // Valider et initialiser le menu depuis le stockage local
    let weeklyMenu = defaultMenu;
    try {
      const storedMenu = JSON.parse(localStorage.getItem('weeklyMenu'));
      if (storedMenu && typeof storedMenu === 'object') {
        // Vérifier que chaque jour et moment a la structure correcte
        for (const day in defaultMenu) {
          if (storedMenu[day] && storedMenu[day].midi && Array.isArray(storedMenu[day].midi) &&
              storedMenu[day].soir && Array.isArray(storedMenu[day].soir)) {
            weeklyMenu[day] = {
              midi: storedMenu[day].midi.filter(meal => meal && meal.name && meal.person),
              soir: storedMenu[day].soir.filter(meal => meal && meal.name && meal.person)
            };
          }
        }
      }
    } catch (e) {
      console.error('Erreur lors de la récupération de localStorage:', e);
      localStorage.removeItem('weeklyMenu'); // Réinitialiser si corrompu
    }

    // Afficher les plats existants
    function renderMenu() {
      for (const day in weeklyMenu) {
        for (const time of ['midi', 'soir']) {
          const ul = document.querySelector(`#${day} ul[data-time="${time}"]`);
          if (ul) {
            ul.innerHTML = '';
            // Vérifier que weeklyMenu[day][time] est un tableau
            const meals = Array.isArray(weeklyMenu[day][time]) ? weeklyMenu[day][time] : [];
            meals.forEach((meal, index) => {
              if (meal && meal.name && meal.person) {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center';
                li.innerHTML = `${meal.name} (${meal.person}) <button class="text-red-500 hover:text-red-700" onclick="removeMeal('${day}', '${time}', ${index})">Supprimer</button>`;
                ul.appendChild(li);
              }
            });
          }
        }
      }
    }

    // Ajouter un plat
    document.getElementById('addMealBtn').addEventListener('click', () => {
      const mealInput = document.getElementById('mealInput').value.trim();
      const day = document.getElementById('daySelect').value;
      const time = document.getElementById('timeSelect').value;
      const person = document.getElementById('personSelect').value;
      
      if (mealInput) {
        // S'assurer que le tableau existe
        if (!Array.isArray(weeklyMenu[day][time])) {
          weeklyMenu[day][time] = [];
        }
        weeklyMenu[day][time].push({ name: mealInput, person: person });
        localStorage.setItem('weeklyMenu', JSON.stringify(weeklyMenu));
        renderMenu();
        document.getElementById('mealInput').value = '';
      } else {
        alert('Veuillez entrer un plat !');
      }
    });

    // Supprimer un plat
    window.removeMeal = function(day, time, index) {
      if (Array.isArray(weeklyMenu[day][time])) {
        weeklyMenu[day][time].splice(index, 1);
        localStorage.setItem('weeklyMenu', JSON.stringify(weeklyMenu));
        renderMenu();
      }
    };

    // Effacer tout le menu
    document.getElementById('clearMenuBtn').addEventListener('click', () => {
      weeklyMenu = JSON.parse(JSON.stringify(defaultMenu)); // Cloner la structure par défaut
      localStorage.setItem('weeklyMenu', JSON.stringify(weeklyMenu));
      renderMenu();
    });

    // Afficher le menu au chargement
    renderMenu();
  </script>
</body>
</html>